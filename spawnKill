#Chris Sequeira 
#spawn, network, kill 

#spawn APM processes
function spawn () {
	for i in APM{1..6};do
		./executables/${i} 8.8.8.8 &
		echo "[+] Started ${i}"
	done
}

#set up csv for getting stats
function setup () {
	echo "time,APM1 CPU,APM2 CPU,APM3 CPU,APM4 CPU,APM4 CPU,APM5 CPU,APM6 CPU,APM1 Memory,APM2 Memory,APM3 Memory,APM4 Memory,APM4 Memory,APM5 Memory,APM6 Memory" > process_metrics.csv
	echo "time,RX Data Rate,TX Data Rate,Disk Writes,Disk Capacity" > system_metrics.csv
}

#hard drive metrics
function hard_drive () {
	drive="nvme0n1"
	kbwps=$(iostat | grep "$drive" | awk '{FS="\t"; print $4}')
	kbw=$(df | grep "\/$" | awk '{print $3 * 0.001024}' | bc)
	echo $kbwps $kbw
}

#network rx and tx of ens interface
function network () {
	ifstat | grep ens | awk '{print $7, $9}'
}

#process metrics
function process () {}

#Collect all metrics

#kill all APM processes 
function cleanup {
	pkill APM
	echo "[+] Killed all processes"
}

spawn
setup
cleanup